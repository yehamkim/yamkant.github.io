<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>[SQL] dbcpë€ ë¬´ì—‡ì´ë©°, api ì„œë²„ì™€ DBëŠ” ì–´ë–»ê²Œ í†µì‹ í• ê¹Œ? - Yamâ€™s Dev Logs</title>
<meta name="description" content="DBCP (DB Connection Pool)    ì°¸ê³ : https://youtu.be/zowzVqx3MQ4   í•´ë‹¹ ê¸€ì€ ìœ„ì˜ ì‰¬ìš´ì½”ë“œ ë‹˜ì˜ ì˜ìƒì„ í† ëŒ€ë¡œ ìš”ì•½í•œ ê¸€ ì…ë‹ˆë‹¤.">


  <meta name="author" content="Yeham Kim">
  
  <meta property="article:author" content="Yeham Kim">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Yam's Dev Logs">
<meta property="og:title" content="[SQL] dbcpë€ ë¬´ì—‡ì´ë©°, api ì„œë²„ì™€ DBëŠ” ì–´ë–»ê²Œ í†µì‹ í• ê¹Œ?">
<meta property="og:url" content="http://localhost:4000/database/database-dbcp/">


  <meta property="og:description" content="DBCP (DB Connection Pool)    ì°¸ê³ : https://youtu.be/zowzVqx3MQ4   í•´ë‹¹ ê¸€ì€ ìœ„ì˜ ì‰¬ìš´ì½”ë“œ ë‹˜ì˜ ì˜ìƒì„ í† ëŒ€ë¡œ ìš”ì•½í•œ ê¸€ ì…ë‹ˆë‹¤.">







  <meta property="article:published_time" content="2023-05-13T20:05:07+09:00">





  

  


<link rel="canonical" href="http://localhost:4000/database/database-dbcp/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Yeham Kim",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Yam's Dev Logs Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--archive">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Yam's Dev Logs
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
<div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Yeham Kim</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>I am an Product Maker.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Seoul</span>
        </li>
      

      
        
          
            <li><a href="mailto:dev.yamkim@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/yamkant" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  

  
  <!--ì „ì²´ ê¸€ ìˆ˜ë¥¼ ì„¸ê¸° ìœ„í•œ ì—°ì‚°. sum ë³€ìˆ˜ì— ì „ì²´ ê¸€ ìˆ˜ ì €ì¥-->



<nav class="nav__list">
    <input id="ac-toc" name="accordion-toc" type="checkbox" />
    <label for="ac-toc">Toggle menu</label>
    <ul class="nav__items" id="category_tag_menu">
        <!--ì „ì²´ ê¸€ ìˆ˜-->
        <li style="font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">
            ğŸ“‚ <span>Total Posts: 24</span>
        </li>
        <li>
            <!--span íƒœê·¸ë¡œ ì¹´í…Œê³ ë¦¬ë“¤ì„ í¬ê²Œ ë¶„ë¥˜ ex) C/C++/C#-->
            <span class="nav__sub-title">Django</span>
            <!--ul íƒœê·¸ë¡œ ê°™ì€ ì¹´í…Œê³ ë¦¬ë“¤ ëª¨ì•„ë‘” í˜ì´ì§€ë“¤ ë‚˜ì—´-->
            <ul>
                <!--Cpp ì¹´í…Œê³ ë¦¬ ê¸€ë“¤ì„ ëª¨ì•„ë‘” í˜ì´ì§€ì¸ /categories/cpp ì£¼ì†Œì˜ ê¸€ë¡œ ë§í¬ ì—°ê²°-->
                <!--category[1].size ë¡œ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ë¥¼ ê°€ì§„ ê¸€ì˜ ê°œìˆ˜ í‘œì‹œ-->
                
                
                
                
                
                
                
                
                <li><a href="/categories/django-strategy" class="">Django Strategy (12)</a></li>
                
                
                
                
                
                
                
                
            </ul>
            <ul>
                
                
                
                
                <li><a href="/categories/django-deep" class="">Django Deep (2)</a></li>
                
                
                
                
                
                
                
                
                
                
                
                
            </ul>
            <span class="nav__sub-title">Error Handle</span>
            <ul>
                
                
                <li><a href="/categories/error-async" class="">ë¹„ë™ê¸° ì²˜ë¦¬ (2)</a></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
            </ul>
            <span class="nav__sub-title">Database</span>
            <ul>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/categories/database" class="">SQL (1)</a></li>
                
                
            </ul>
        </li>
    </ul>
</nav>
  

</div>


  <div class="archive">
    
      <h1 id="page-title" class="page__title">[SQL] dbcpë€ ë¬´ì—‡ì´ë©°, api ì„œë²„ì™€ DBëŠ” ì–´ë–»ê²Œ í†µì‹ í• ê¹Œ?</h1>
    
    <h1 id="dbcp-db-connection-pool">DBCP (DB Connection Pool)</h1>
<ul>
  <li>ì°¸ê³ : https://youtu.be/zowzVqx3MQ4</li>
  <li>í•´ë‹¹ ê¸€ì€ ìœ„ì˜ ì‰¬ìš´ì½”ë“œ ë‹˜ì˜ ì˜ìƒì„ í† ëŒ€ë¡œ ìš”ì•½í•œ ê¸€ ì…ë‹ˆë‹¤.</li>
</ul>

<p><strong>í†µì‹ ë°©ë²•</strong></p>
<ul>
  <li>ë°±ì—”ë“œ ì„œë²„ì™€ DB ì„œë²„ëŠ” TCP ê¸°ë°˜ìœ¼ë¡œ í†µì‹ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ, connectionì„ ë§ºì–´ ì—´ê±°ë‚˜ ë‹«ì•„ì„œ ì—°ê²°í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.</li>
  <li>DB ì„œë²„ë¥¼ ì—´ê³  ë‹«ì„ ë•Œë§ˆë‹¤ ì‹œê°„ì ì¸ ë¹„ìš©ì´ ë°œìƒí•˜ê²Œ ë˜ê³ , ì´ëŠ” ì„œë¹„ìŠ¤ ì„±ëŠ¥ì— ì¢‹ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
</ul>

<p><strong>DBCPì˜ ê°œë…ê³¼ ì›ë¦¬</strong></p>
<ol>
  <li>ë°±ì—”ë“œ ì„œë²„ëŠ” DB ì„œë²„ì™€ í†µì‹ í•˜ê¸° ìœ„í•´ ë¯¸ë¦¬ DB connectionì„ ë§Œë“¤ì–´ë‘ê³ , í’€ì²˜ëŸ¼ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. ì´ë¥¼ DBCPë¼ê³  í•©ë‹ˆë‹¤.</li>
  <li>[get connection] API ìš”ì²­ì„ ë°›ì•„, DBë¥¼ ì¡°íšŒí•˜ëŠ” ìƒí™©ì´ ë°œìƒí•˜ë©´ connection poolì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ connectionì„ ê°€ì ¸ì™€ì„œ ëŒ€ì—¬í•©ë‹ˆë‹¤.</li>
  <li>connectionì„ í†µí•´ ì¿¼ë¦¬ë¥¼ DB ì„œë²„ë¡œ ìš”ì²­í•˜ê³ , ë°ì´í„°ë¥¼ ë°›ìŠµë‹ˆë‹¤.</li>
  <li>[close connection] ë¹Œë ¤ì™”ë˜ connectionì„ connection poolì— ë‹¤ì‹œ ë°˜í™˜í•©ë‹ˆë‹¤.</li>
  <li>API ì‘ë‹µì„ ë°˜í™˜í•©ë‹ˆë‹¤.</li>
</ol>

<ul>
  <li>ìœ„ì™€ ê°™ì´, connection poolì„ ì‚¬ìš©í•œë‹¤ë©´ connectionì„ ì¬ì‚¬ìš©í•˜ë¯€ë¡œì¨ DBì™€ì˜ TCP ì—°ê²° ì‹œê°„ì„ ì ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<p><strong>DBCP ì„¤ì • ë°©ë²•</strong></p>
<ul>
  <li>í•´ë‹¹ ê°•ì˜ì—ì„œëŠ” DB ì„œë²„ëŠ” MySQLì„, ë°±ì—”ë“œ ì„œë²„ëŠ” HikariCPë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  <li>DB connectionì€ ë°±ì—”ë“œ ì„œë²„ì™€ DB ì„œë²„ ê°ê°ì—ì„œì˜ ì„¤ì • ë°©ë²•ì„ ì˜ ì•Œê³  ìˆì–´ì•¼í•©ë‹ˆë‹¤.</li>
</ul>

<h3 id="mysql-db-connection-ì„¤ì •-ë°©ë²•">MySQL DB Connection ì„¤ì • ë°©ë²•</h3>
<p><strong>max_connections</strong></p>
<ul>
  <li>client(ë°±ì—”ë“œ ì„œë²„)ì™€ ë§ºì„ ìˆ˜ ìˆëŠ” ìµœëŒ€ connection ìˆ˜ë¥¼ ê²°ì •í•˜ëŠ” íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">max_connections</code>ë¥¼ ì—¬ìœ ìˆê²Œ ì„¤ì •í•˜ì§€ ì•Šê²Œ ë˜ë©´, DBCPì˜ connection ìˆ˜ê°€ ì¦ê°€í•´ì•¼í•˜ëŠ” ê²½ìš°ì— DB ì„œë²„ì™€ connectioní•  ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.</li>
</ul>

<p><strong>wait_timeout</strong></p>
<ul>
  <li>DB ì„œë²„ì—ì„œ connectionì´ inactive í•  ë•Œ, ë‹¤ì‹œ ìš”ì²­ì´ ì˜¤ê¸°ê¹Œì§€ ì–¼ë§ˆì˜ ì‹œê°„ì„ ê¸°ë‹¤ë¦° ë’¤ close í•  ê²ƒì¸ì§€ë¥¼ ê²°ì •í•˜ëŠ” íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">wait_timeout</code> ì´ë‚´ì— ìš”ì²­ì´ ë„ì°©í•œë‹¤ë©´ 0ìœ¼ë¡œ ì‹œê°„ì„ ì´ˆê¸°í™” í•˜ê³  ìƒˆë¡œìš´ ìš”ì²­ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.</li>
  <li>connection poolì— connectionë“¤ì´ ìˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³ , ë°±ì—”ë“œ ì„œë²„ì—ì„œ ì–´ë–¤ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ connectionì„ ì¢…ë£Œí•˜ê³  ë°˜í™˜í•˜ì§€ ëª»í•œë‹¤ë©´, DB ì„œë²„ëŠ” í•˜ì—¼ì—†ì´ connectionì„ ë§ºì–´ë‘ê³  resourceë¥¼ ë‚­ë¹„í•  ìˆ˜ ë°–ì— ì—†ê²Œë©ë‹ˆë‹¤.</li>
  <li>ë”°ë¼ì„œ, DB ì„œë²„ëŠ” <code class="language-plaintext highlighter-rouge">wait_timeout</code>ì˜ ì‹œê°„ë§Œí¼ ê¸°ë‹¤ë¦° í›„, ë¹„ì •ìƒì ì¸ ìƒí™©ì„ì„ ê°ì§€í•˜ë©´ í•´ë‹¹ connectionì„ ëŠê³  ìì›ì„ íšŒìˆ˜í•©ë‹ˆë‹¤.</li>
</ul>

<h3 id="ë°±ì—”ë“œ-ì„œë²„-db-connection-ì„¤ì •-ë°©ë²•-hikaricp">ë°±ì—”ë“œ ì„œë²„ DB Connection ì„¤ì • ë°©ë²• (HikariCP)</h3>
<p><strong>minimumIdle</strong></p>
<ul>
  <li>poolì—ì„œ ìœ ì§€í•˜ëŠ” ìµœì†Œí•œì˜ idle(ìš”ì²­ì´ ì˜¬ ë•Œ ê¹Œì§€ ëŒ€ê¸°í•˜ê³  ìˆëŠ” ìœ íœ´ìì›) connectionì˜ ìˆ˜ë¥¼ ê²°ì •í•˜ëŠ” íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤.</li>
  <li>connectionë“¤ì´ ê³„ì† ì‚¬ìš© ë˜ë‹¤ê°€ ëª¨ë‘ ë°˜í™˜ë˜ì–´ ì—¬ëŸ¬ê°œì˜ connectionì´ ìƒê¸°ë”ë¼ë„, <code class="language-plaintext highlighter-rouge">minimumIdle</code>ì˜ ê°œìˆ˜ì— ë§ë„ë¡ ë‚˜ë¨¸ì§€ connectionì€ ëŠì–´ì¤ë‹ˆë‹¤.
<strong>maximumPoolSize</strong></li>
  <li>poolì´ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ìµœëŒ€ connectionì˜ ìˆ˜(idleê³¼ active(in-use) connectionì„ í•©ì¹œ)ë¥¼ ê²°ì •í•˜ëŠ” íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤.</li>
  <li>ì´ëŠ” minimumIdle ë³´ë‹¤ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§€ê²Œ ë˜ì–´ ì ìœ ì¤‘ì¸ connectionì´ minimumIdleë³´ë‹¤ ì‘ë‹¤ë©´ ìƒˆë¡œ ê°’ì„ ì¶”ê°€í•´ì•¼í•˜ì§€ë§Œ, maximumPoolSize ì´ìƒìœ¼ë¡œ ì¶”ê°€í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. (ì•„ë˜ ì˜ˆì‹œ)</li>
  <li>minimumIdleì´ 2ì´ê³ , maximumPoolSizeê°€ 4ì¸ ê²½ìš°: connection poolì— 4ê°œì˜ connectionì´ ìˆê³ , ê·¸ ì¤‘ ì„¸ ê°œì˜ connectionì´ ì ìœ  ì¤‘ì´ê³ , í•˜ë‚˜ê°€ idle connection ìƒíƒœì¼ ë•Œ -&gt; maximumPoolSizeê°€ 4ì´ê¸° ë•Œë¬¸ì— connectionì„ ì¶”ê°€í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤.
<strong>maxLifetime</strong></li>
  <li>poolì—ì„œ connectionì˜ ìµœëŒ€ ìˆ˜ëª…ì„ ì„¤ì •í•˜ëŠ” íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤.</li>
  <li>pool ë‚´ì˜ connection ìƒíƒœê°€ ì´ë¥¼ ë„˜ê¸°ë©´ idleì¸ ê²½ìš° ë°”ë¡œ ì œê±°í•˜ê³ , active ì¸ ê²½ìš°ëŠ” poolë¡œ ë°˜í™˜ í›„ì— ì œê±°í•©ë‹ˆë‹¤.</li>
  <li>ì£¼ì˜: <code class="language-plaintext highlighter-rouge">maxLifetime</code>ì´ ì œëŒ€ë¡œ ë™ì‘í•˜ê¸° ìœ„í•´ì„œëŠ” connectionì´ ì œ ë•Œ ë°˜í™˜ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ, API ì²˜ë¦¬ê°€ ê¸¸ì–´ì ¸ connectionì„ ì˜¤ë˜ ì ìœ í•˜ê³  DB ì„œë²„ì—ì„œ <code class="language-plaintext highlighter-rouge">wait_timeout</code>ì— ì˜í•´ ì—°ê²°ë„ ëŠê¸´ ìƒíƒœë¼ë©´ <code class="language-plaintext highlighter-rouge">maxLifetime</code>ì´ ìºì¹˜í•  ìˆ˜ ì—†ëŠ” ë©”ëª¨ë¦¬ connection ëˆ„ìˆ˜ í˜„ìƒì´ ë°œìƒí•˜ê²Œ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ê¶Œìœ : DB ì„œë²„ì˜ connection time limit(MySQLì˜ ê²½ìš°, <code class="language-plaintext highlighter-rouge">wait_timeout</code>)ë³´ë‹¤ 2~3ì´ˆ ì •ë„ ë” ì§§ê²Œ ì„¤ì •í•´ë‘ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. connectionì„ í†µí•œ ì²˜ë¦¬ ìš”ì²­ì´ DB ì„œë²„ê¹Œì§€ ë‹¤ë‹¤ë¥´ê¸° ì „ì— DB ì„œë²„ì˜ connection timeì´ ë§Œë£Œë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
<strong>connectionTimeout</strong></li>
  <li>poolì—ì„œ connectionì„ ë°›ê¸° ìœ„í•œ ëŒ€ê¸° ì‹œê°„ìœ¼ë¡œ, ë°±ì—”ë“œ ì„œë²„ì— íŠ¸ë˜í”½ì´ ë°€ë ¤ì˜¬ ë•Œ í•´ë‹¹ ì‹œê°„ ë‚´ì— poolì—ì„œ connectionì„ ë°›ì•„ì˜¤ì§€ ëª»í•˜ëŠ” ê²½ìš° exceptionì´ ë°œìƒí•©ë‹ˆë‹¤.</li>
  <li>í•´ë‹¹ ì‹œê°„ì„ ì„¤ì •í•  ë•Œ, ì„œë¹„ìŠ¤ ì´ìš©ìê°€ ìš”ì²­ í›„ ì–¼ë§ˆë‚˜ ëŒ€ê¸°í•  ìˆ˜ ìˆëŠ”ì§€ê¹Œì§€ íŒë‹¨í•˜ì—¬ ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤. timeout ì‹œê°„ì„ 30ì´ˆë¡œ ì¡ë”ë¼ë„ ì„œë¹„ìŠ¤ ì´ìš©ìê°€ ë°±ì—”ë“œ ì„œë²„ì™€ì˜ ì—°ê²°ì„ ëŠëŠ”ë‹¤ë©´ ì˜ë¯¸ê°€ ì—†ê¸° ë–„ë¬¸ì…ë‹ˆë‹¤.</li>
</ul>

<h2 id="ì ì ˆí•œ-connection-ìˆ˜ë¥¼-ì°¾ê¸°-ìœ„í•œ-ê³¼ì •">ì ì ˆí•œ connection ìˆ˜ë¥¼ ì°¾ê¸° ìœ„í•œ ê³¼ì •</h2>
<ul>
  <li>ê¸°ë³¸ì ìœ¼ë¡œ DB ì„œë²„ë¥¼ êµ¬ì„±í•  ë•Œ, ê³ ê°€ìš©ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ replicationìœ¼ë¡œ êµ¬ì„±í•©ë‹ˆë‹¤. Primary ì„œë²„ëŠ” read-writeë¥¼ ë‹´ë‹¹í•˜ê³ , Secondary ì„œë²„ëŠ” read-onlyë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤.</li>
  <li>ì ì ˆí•œ connection ìˆ˜ë¥¼ ì°¾ê¸° ìœ„í•´ ëª¨ë‹ˆí„°ë§ í™˜ê²½(ì„œë²„ ë¦¬ì†ŒìŠ¤, ì„œë²„ ìŠ¤ë ˆë“œ ìˆ˜, DBCP ë“±ë“±)ì„ êµ¬ì¶•í•©ë‹ˆë‹¤.</li>
  <li>ë°±ì—”ë“œ ì‹œìŠ¤í…œì— ëŒ€í•œ ë¶€í•˜ í…ŒìŠ¤íŠ¸(tool: nGrinder)ë¥¼ ìˆ˜í–‰í•˜ë©´ì„œ trafficì— ë”°ë¥¸ ì„œë²„ì˜ ë™ì‘ì„ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.</li>
  <li>ê´€ì°°í•´ì•¼í•  ì‚¬í•­: ë°±ì—”ë“œ ì„œë²„, DB ì„œë²„ì˜ CPU, MEM ë“±ì˜ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥ ì„ í™•ì¸
    <ul>
      <li>request per second: <strong>ë°±ì—”ë“œ ì‹œìŠ¤í…œì˜ ì „ì²´ì ì¸ ì²˜ë¦¬ëŸ‰</strong>ì„ ë³´ê¸° ìœ„í•œ ì§€í‘œì…ë‹ˆë‹¤.</li>
      <li>average response time: ìš”ì²­ì„ ì²˜ë¦¬í•  ë•Œ í‰ê· ì ì¸ ì‘ë‹µì²˜ë¦¬ë¥¼ ë³´ë©°, <strong>api ì„±ëŠ¥ì„ í™•ì¸í•˜ëŠ” ì§€í‘œ</strong>ë¥¼ í™•ì¸í•´ì•¼í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ë§Œì•½ íŠ¸ë˜í”½ì´ ë§ì•„ì§ì— ë”°ë¼ì„œ ë°±ì—”ë“œ ì„œë²„ëŠ” ë¬¸ì œê°€ ì—†ì§€ë§Œ DB ì„œë²„ì— ë¬¸ì œê°€ ìˆëŠ” ê²½ìš°
    <ul>
      <li>select ì¿¼ë¦¬ë¥¼ ë§ì´ ì²˜ë¦¬í•˜ê²Œ ë˜ë©´ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¼ë©´, Secondary ì„œë²„ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</li>
      <li>ë°±ì—”ë“œ ì„œë²„ì™€ DB ì„œë²„ ì‚¬ì´ì— Cache layerë¥¼ ë‘ì–´ DB ì„œë²„ê°€ ì§ì ‘ì ìœ¼ë¡œ ë°›ëŠ” ë¶€í•˜ë¥¼ ë‚®ì¶œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>Shardingì„ ì´ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>thread per request ëª¨ë¸ì¸ ê²½ìš°, active thread ìˆ˜ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</li>
</ul>

<p><strong>ì¶”ê°€ ê³µë¶€</strong></p>
<ul>
  <li>Naver D2: https://d2.naver.com/helloworld/5102792</li>
  <li>hikariCP github: https://github.com/brettwooldridge/HikariCP</li>
  <li>MySQL ì„¤ì • í˜ì´ì§€: https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html</li>
</ul>

<hr />
<p><strong>ì°¸ê³ </strong></p>
<ul>
  <li>https://jojoldu.tistory.com/634</li>
  <li>https://d2.naver.com/helloworld/5102792</li>
</ul>

<h3 id="sequelizeì—ì„œ-í…ŒìŠ¤íŠ¸-í•´ë³´ê¸°">Sequelizeì—ì„œ í…ŒìŠ¤íŠ¸ í•´ë³´ê¸°</h3>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app.js</span>
<span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">dotenv</span><span class="dl">'</span><span class="p">).</span><span class="nf">config</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">()</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span>

<span class="kd">const</span> <span class="nx">Sequelize</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">sequelize</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sequelize</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sequelize</span><span class="p">(</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_NAME</span><span class="p">,</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_USER</span><span class="p">,</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_PASSWORD</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="na">host</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_HOST</span><span class="p">,</span>
        <span class="na">dialect</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_DIALECT</span><span class="p">,</span>
        <span class="na">operatorsAliases</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>

        <span class="na">pool</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">max</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="na">min</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="c1">// acquire: procee.env.pool.acquire,</span>
            <span class="c1">// idle: procee.env.pool.idle</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">);</span>
<span class="nx">sequelize</span>
    <span class="p">.</span><span class="nf">sync</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Connected database</span><span class="dl">'</span><span class="p">))</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to connect db </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">e</span><span class="p">))</span>

<span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/test-timeout</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">startTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">sequelize</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="dl">"</span><span class="s2">SELECT SLEEP(3);</span><span class="dl">"</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">lag</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Lag: </span><span class="p">${</span><span class="nx">lag</span><span class="p">}</span><span class="s2">ms`</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">lag</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Lag: </span><span class="p">${</span><span class="nx">lag</span><span class="p">}</span><span class="s2">ms`</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">db error</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="dl">'</span><span class="s1">msg</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ok</span><span class="dl">'</span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nf">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Example app listening on port </span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">});</span>
</code></pre></div></div>
<ul>
  <li>DBì˜ ì»¤ë„¥ì…˜ í’€ì„ 5ë¡œ ì œí•œí•˜ì˜€ê³ , ê° ì¿¼ë¦¬ë‹¹ DB ìˆ˜í–‰ ì‹œê°„ì„ 3ì´ˆë¼ê³  ê°€ì •í•˜ì˜€ìŠµë‹ˆë‹¤.</li>
  <li>ì•„ë˜ì™€ ê°™ì´ <a href="https://httpd.apache.org/docs/2.4/ko/programs/ab.html">Apache Bench</a>ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶€í•˜í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´, 20ëª…ì˜ ìœ ì €ê°€ ë™ì‹œì— ì €í¬ ì„œë²„ì— 100íšŒ ìš”ì²­ì„ ë³´ë‚´ëŠ” ìƒí™©ì„ ê°€ì •í•˜ì˜€ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ab <span class="nt">-n</span> 100 <span class="nt">-c</span> 20 https://localhost:4000/test-timeout
This is ApacheBench, Version 2.3 &lt;<span class="nv">$Revision</span>: 1879490 <span class="nv">$&gt;</span>
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking localhost <span class="o">(</span>be patient<span class="o">)</span>.....done


Server Software:        nginx/1.21.6
Server Hostname:        localhost
Server Port:            4000
SSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-CHACHA20-POLY1305,4096,256
Server Temp Key:        ECDH X25519 253 bits
TLS Server Name:        localhost

Document Path:          /km/test-timeout
Document Length:        12 bytes

Concurrency Level:      20
Time taken <span class="k">for </span>tests:   64.159 seconds
Complete requests:      100
Failed requests:        0
Total transferred:      27200 bytes
HTML transferred:       1200 bytes
Requests per second:    1.56 <span class="o">[</span><span class="c">#/sec] (mean)</span>
Time per request:       12831.748 <span class="o">[</span>ms] <span class="o">(</span>mean<span class="o">)</span>
Time per request:       641.587 <span class="o">[</span>ms] <span class="o">(</span>mean, across all concurrent requests<span class="o">)</span>
Transfer rate:          0.41 <span class="o">[</span>Kbytes/sec] received

Connection Times <span class="o">(</span>ms<span class="o">)</span>
              min  mean[+/-sd] median   max
Connect:       14   77  59.8     48     243
Processing:  3039 11087 2476.8  12026   12342
Waiting:     3039 11086 2476.8  12026   12342
Total:       3101 11164 2459.8  12095   12370

Percentage of the requests served within a certain <span class="nb">time</span> <span class="o">(</span>ms<span class="o">)</span>
  50%  12095
  66%  12171
  75%  12199
  80%  12222
  90%  12303
  95%  12315
  98%  12332
  99%  12370
 100%  12370 <span class="o">(</span>longest request<span class="o">)</span>

<span class="c"># consoleì˜ ê²°ê³¼ ========================================</span>
Lag: 3093.0100421905518ms
Lag: 3056.129874944687ms
Lag: 3071.250333070755ms
Lag: 3063.7896671295166ms
Lag: 3065.905833005905ms
Lag: 3056.715542078018ms

Lag: 6105.021874904633ms
Lag: 6107.211666107178ms
Lag: 6109.895124912262ms
Lag: 6116.28054189682ms
Lag: 6118.377749919891ms

Lag: 9111.812832832336ms
Lag: 9110.667292118073ms
Lag: 9115.994791030884ms
Lag: 9120.64020895958ms
Lag: 9124.2014169693ms

Lag: 12140.2624168396ms
Lag: 12141.329499959946ms
Lag: 12143.3755838871ms
Lag: 12145.10533285141ms
Lag: 12145.73112487793ms

Lag: 12126.067250013351ms
Lag: 12110.478208065033ms
Lag: 12111.195416927338ms
Lag: 12106.155959129333ms
Lag: 12108.08195900917ms
...
</code></pre></div></div>

<ul>
  <li>20ëª…ì´ 5ê°œì˜ ì»¤ë„¥ì…˜ í’€ë¡œ ëª¨ë“  ì‘ì—…ì„ ì™„ë£Œí•´ì•¼í•©ë‹ˆë‹¤. 1,2,3,4,5ë²ˆì´ ì²˜ìŒ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ, ê°€ì¥ ë¨¼ì € ìš”ì²­í•œ ë‹¤ì„¯ëª…ì€ ì²˜ë¦¬ê°€ ì œ ë•Œ ì™„ë£Œë˜ì–´ 3ì´ˆì˜ ì§€ì—°ì´ ìˆê³ (ê¸°ë‹¤ë¦¬ëŠ” ìš”ì²­ 15ê°œ), 6,7,8,9,10ë²ˆì€ ì•ì˜ ë‹¤ì„¯ëª…ì„ ê¸°ë‹¤ë¦¬ëŠë¼ 6ì´ˆì˜ ì§€ì—°ì´ ìˆìŠµë‹ˆë‹¤.(ì²˜ë¦¬ëœ ìš”ì²­ 5ê°œ, ëŒ€ê¸°ì¤‘ì¸ ìš”ì²­ 10ê°œ)</li>
  <li>ì´ ë•Œ, ì²˜ë¦¬ëœ ìš”ì²­ì´ ë‹¤ì‹œ ìš”ì²­ì„ ë³´ë‚´ë¯€ë¡œ 6,7,8,9,10ì´ DB ë™ì‘ì„ ì²˜ë¦¬í•˜ê¸° ì‹œì‘í•  ë•Œ, ì´ë¯¸ 1,2,3,4,5ë²ˆì˜ ë‘ ë²ˆì§¸ ìš”ì²­ì´ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.</li>
  <li>ë”°ë¼ì„œ 1,2,3,4,5ë²ˆì˜ ë‘ ë²ˆì§¸ ìš”ì²­ë¶€í„°ëŠ” ì‘ë‹µì„ ë°›ìœ¼ë ¤ë©´ 12000ms ì •ë„ê°€ ê±¸ë¦¬ê²Œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ì™€ ê°™ì´ ëª¨ë“  ìœ ì €ì˜ ë‘ ë²ˆì§¸ ìš”ì²­ë¶€í„°ëŠ” 12000ms ì •ë„ê°€ ê±¸ë¦¬ê²Œ ë˜ì–´ Lagê°€ ì¼ì • ì‹œì ë¶€í„°ëŠ” 12000msë¡œ ê³ ì •ë©ë‹ˆë‹¤.</li>
</ul>

  </div>
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/yamkant" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Yeham Kim. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
